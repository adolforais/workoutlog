<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adolfo's workout log</title>
<style>
  body { font-family: Arial, sans-serif; margin: 15px; }
  h1 { color: #2d7d46; }
  label, select, input { font-size: 1em; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #bbb; padding: 6px; text-align: center; }
  th { background: #f0f0f0; }
  .hidden { display: none; }
  .btn { margin: 10px 5px 10px 0; padding: 6px 16px; font-size: 1em; }
  .small { font-size: 0.9em; color: #666; }

  /* ---- Your background styles here ---- */
  body {
    background-color: white; /* fallback */
    background-image: url('bkg_image.jpg');
    background-repeat: repeat;
    background-size: contain;
    background-position: left top;
  }

  #mainContent {
    background-color: rgba(255, 255, 255, 0.6);
    padding: 15px;
    border-radius: 8px;
  }
</style>

  <!-- Program and day names data -->
  <script src="workout_program.js"></script>
</head>
<body>
  <div id="mainContent">
    <h1>Adolfo's workout log</h1>
    <form id="logForm">
      <label>Date: <input type="date" id="date" required></label><br><br>
      <label>Week:
        <select id="week" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </label>
      <label style="margin-left:1em">Day:
        <select id="day" required></select>
      </label>
      <button type="button" class="btn" onclick="generateTable()">Show Exercises</button>
    </form>
    <div id="session"></div>
    <hr>
    <h2>Session Log</h2>
    <div id="log"></div>
    <button onclick="clearLog()" class="btn">Clear All Logs</button>
    <button onclick="exportJSON()" class="btn">Export Log (JSON)</button>
    <button onclick="importJSON()" class="btn">Import Log (JSON)</button>
    <input type="file" id="importFile" class="hidden" accept=".json" onchange="handleFileImport(event)">
  </div>

<script>
function renderDayOptions() {
  const daySelect = document.getElementById('day');
  daySelect.innerHTML = "";
  for (const key in programDays) {
    const opt = document.createElement("option");
    opt.value = key;
    opt.textContent = programDays[key];
    daySelect.appendChild(opt);
  }
}

function generateTable() {
  const week = parseInt(document.getElementById('week').value) - 1;
  const day = document.getElementById('day').value;
  const sessionDiv = document.getElementById('session');
  const exercises = program[day];
  let html = `<h3>${document.getElementById('day').options[document.getElementById('day').selectedIndex].text} - Week ${week+1}</h3>`;
  html += `<form id='sessionForm' onsubmit='saveSession(event)'>`;
  html += `<table><tr><th>Exercise</th><th>Weight</th>`;
  let maxSets = Math.max(...exercises.map(e => e.sets[week]));
  for (let s = 1; s <= maxSets; ++s) html += `<th>Set ${s} reps<br><span class='small'>(target)</span></th>`;
  html += `</tr>`;
  exercises.forEach(ex => {
    html += `<tr><td>${ex.name}<br><span class='small'>${ex.sets[week]} Ã— ${ex.reps[week]}</span></td>`;
    html += `<td><input type='number' min='0' max='999' step='0.5' name='w_${ex.name}' placeholder='kg' required></td>`;
    for (let s = 0; s < ex.sets[week]; ++s) {
      html += `<td><input type='number' min='0' max='99' name='r_${ex.name}_${s+1}' placeholder='Reps' required></td>`;
    }
    for (let s = ex.sets[week]; s < maxSets; ++s) html += `<td class='hidden'></td>`;
    html += `</tr>`;
  });
  html += `</table><br>`;
  html += `<button type='submit' class='btn'>Save Session</button></form>`;
  sessionDiv.innerHTML = html;
}

function saveSession(event) {
  event.preventDefault();
  const date = document.getElementById('date').value;
  const week = document.getElementById('week').value;
  const day = document.getElementById('day').value;
  const form = document.getElementById('sessionForm');
  const exercises = program[day];
  let entry = { date, week, day, log: [] };
  exercises.forEach(ex => {
    let exObj = { name: ex.name, weight: form[`w_${ex.name}`].value, reps: [] };
    for (let s = 1; s <= ex.sets[week-1]; ++s) {
      exObj.reps.push(form[`r_${ex.name}_${s}`].value);
    }
    entry.log.push(exObj);
  });
  let allLogs = JSON.parse(localStorage.getItem('hypertrophyLogs') || '[]');
  allLogs.push(entry);
  localStorage.setItem('hypertrophyLogs', JSON.stringify(allLogs));
  document.getElementById('session').innerHTML = '<b>Session saved!</b>';
  renderLog();
}

function renderLog() {
  const out = document.getElementById('log');
  let allLogs = JSON.parse(localStorage.getItem('hypertrophyLogs') || '[]');
  if (!allLogs.length) { out.innerHTML = '<i>No sessions logged yet.</i>'; return; }
  let html = '';
  allLogs.slice().reverse().forEach(e => {
    html += `<b>${e.date}</b> | Week ${e.week} | ${programDays[e.day] || e.day}<br><table><tr><th>Exercise</th><th>Weight</th>`;
    let sets = e.log.map(x => x.reps.length);
    let maxSets = Math.max(...sets);
    for (let i = 1; i <= maxSets; ++i) html += `<th>Set ${i} reps</th>`;
    html += `</tr>`;
    e.log.forEach(ex => {
      html += `<tr><td>${ex.name}</td><td>${ex.weight}</td>`;
      ex.reps.forEach(r => html += `<td>${r}</td>`);
      for (let s = ex.reps.length; s < maxSets; ++s) html += `<td></td>`;
      html += `</tr>`;
    });
    html += `</table><br>`;
  });
  out.innerHTML = html;
}

function clearLog() {
  if (confirm('Clear ALL logs?')) {
    localStorage.removeItem('hypertrophyLogs');
    renderLog();
  }
}

// EXPORT uses last session date in filename
function exportJSON() {
  let allLogs = localStorage.getItem('hypertrophyLogs');
  if (!allLogs) { alert('No sessions to export!'); return; }
  let logsArray = JSON.parse(allLogs);
  if (!Array.isArray(logsArray) || logsArray.length === 0) {
    alert('No sessions to export!'); return;
  }
  let lastSession = logsArray[logsArray.length - 1];
  let lastDate = lastSession.date || 'session';
  let safeDate = lastDate.replace(/[^0-9\-]/g, '');
  let filename = `hypertrophy_workout_log_${safeDate}.json`;

  let blob = new Blob([allLogs], {type: 'application/json'});
  let url = URL.createObjectURL(blob);
  let a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function importJSON() {
  document.getElementById('importFile').click();
}
function handleFileImport(event) {
  let file = event.target.files[0];
  if (!file) return;
  let reader = new FileReader();
  reader.onload = function(e) {
    try {
      let logs = JSON.parse(e.target.result);
      if (!Array.isArray(logs)) throw 'Invalid format';
      if (!confirm('Overwrite your current log with the imported file?')) return;
      localStorage.setItem('hypertrophyLogs', JSON.stringify(logs));
      renderLog();
      alert('Log imported!');
    } catch {
      alert('Invalid file or format.');
    }
  };
  reader.readAsText(file);
}

// --- On load ---
document.addEventListener('DOMContentLoaded', function() {
  renderDayOptions();
  renderLog();
});
</script>
</body>
</html>
